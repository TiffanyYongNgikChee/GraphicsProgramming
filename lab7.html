<!DOCTYPE html>
    <html>
        <head>
            <title>D3.js Demo</title>
            <meta charset="UTF-8">
            <!-- Include D3.js (v5) and jQuery using CDN links -->
            <script src="https://d3js.org/d3.v5.min.js"></script>
            <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

            <style type="text/css">
                /* Style to make axis labels bigger */
                .axis-label {
                    font-size: 16px;
                    font-weight: bold;
                }
                /* Style for chart title */
                .chart-title {
                    font-size: 24px;
                    font-weight: bold;
                    text-anchor: middle;
                }
            </style>
        </head>
        <body>
            <!-- HTML Content -->
            <h1>Tiffany Yong</h1>
            <!-- JavaScript Section -->
            <script type="text/javascript">
                console.log("D3 and jQuery are successfully loaded.");
                $.getJSON("https://tinyurl.com/k4chnujx", function(data)
                {
                    //print to console
                    console.log(data);
                    //call function
                    plotCO2Data(data);
                });

                //Executed once the file has downloaded
                function plotCO2Data(data){
                    //Set up SVG size and margins
                    var margin = { top: 50, right: 50, bottom: 50, left:80},
                        width = 900 - margin.left - margin.right,
                        height = 670 - margin.top - margin.bottom;

                    //Create x and y scales for CO2 values (y-axis (integer - ppm)) and time (x-axis (integer â€“ years ago)) 
                    var y = d3.scaleLinear()
                        .domain(d3.extent(data,function(d){ return d["co2_ppmv"];}))
                        .range([height,0]); //seems backwards because svg y is down
                    var x = d3.scaleLinear()
                        .domain(d3.extent(data,function(d){ return (d["years_before_2023"]);})) //CO2 values
                        .range([0,width]);  
                    
                    //Create axis(x and y) - specify number of ticks in the axis
                    //x us the d3.scaleTime()
                    var xAxis = d3.axisBottom(x)
                        .ticks(3);//specify the number of ticks
                    //y is the d3.scaleLinear
                    var yAxis = d3.axisLeft(y)
                        .ticks(3);//specify the number of ticks
               
                    //Create line (d3.line()) objects
                    var valueLine = d3.line() //draw line - map x,y coords for each data point using the scales
                        .x(function(d){return x(d["years_before_2023"])}) 
                        .y(function(d){return y(d["co2_ppmv"])});

                    //Append an SVG element to the webpage
                    var svg = d3.select('body')
                        .append("svg")
                            .attr("width",width + margin.left + margin.right)
                            .attr("height",height + margin.top + margin.bottom)
                        .append("g")
                        //adds an offset
                        .attr("transform","translate(" + margin.left + ","+margin.top+")")
                        ;
                    
                    // Append chart title
                    svg.append("text")
                        .attr("class", "chart-title")
                        .attr("x", width / 2)
                        .attr("y", -30)
                        .text("Atmospheric CO2 Level Over Time");
                    
                    //add axes and the line object to the SVG
                    svg.append('g') //append a <g> - group element
                        .attr('class','x axis')
                        .attr("transform", "translate(0," + height + ")")
                        .call(xAxis); //let the axis do its thing
                    svg.append('g')
                        .attr('class','y axis') //specity classes
                        .call(yAxis);
                    svg.append("path") //Add the valueline path
                        .attr("d",valueLine(data))
                        .attr("stroke", "red") //Make the graph line red
                        .attr("stroke-width", 2)
                        .attr("fill", "none");
                    
                    // Add x-axis label with larger font size
                    svg.append("text")
                        .attr("class", "x label axis-label")
                        .attr("x", width/2-50)
                        .attr("y", height + 40)
                        .text("years_before_2023");

                    // Add y-axis label with larger font size
                    svg.append("text")
                        .attr("class", "y label axis-label")
                        .attr("y", -50)
                        .attr("x", -height / 2)
                        .attr("transform", "rotate(-90)")
                        .attr("text-anchor", "middle")
                        .text("Atmospheric CO2 Level");

                }
                
                function zoomed() {
                    if (d3.event.sourceEvent && d3.event.sourceEvent.type === "brush") return; // ignore zoom-by-brush
                    var t = d3.event.transform;
                    x.domain(t.rescaleX(x2).domain());
                    Line_chart.select(".line").attr("d", line);
                    focus.select(".axis--x").call(xAxis);
                    context.select(".brush").call(brush.move, x.range().map(t.invertX, t));
                }

                function brushed() {
                    if (d3.event.sourceEvent && d3.event.sourceEvent.type === "zoom") return; // ignore brush-by-zoom
                    var s = d3.event.selection || x2.range();
                    x.domain(s.map(x2.invert, x2));
                    Line_chart.select(".line").attr("d", line);
                    focus.select(".axis--x").call(xAxis);
                    svg.select(".zoom").call(zoom.transform, d3.zoomIdentity
                        .scale(width / (s[1] - s[0]))
                        .translate(-s[0], 0));
                }

            </script>
        </body>
    </html>
